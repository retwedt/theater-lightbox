function TheaterLightbox(){this.posters=document.querySelectorAll(".theater"),this.groupNames=[],this.groups={},this.currentPosterNum=0,this.currentPosterGroup="null",this.timelineMarkers=[],this.mediaWidth=0,this.mediaHeight=0,this.ytWidth=560,this.ytHeight=315,this.modalWrap,this.modal,this.modalRight,this.modalLeft,this.modalClose,this.modalContent,this.modalText,this.image,this.iframe,this.timelineWrap,this.bigDot,this.smallDot}var newTheater,winWidth=0,winHeight=0;TheaterLightbox.prototype.buildModal=function(){this.modalWrap=document.createElement("div"),this.modalWrap.setAttribute("class","modal-wrap theater-bg-inactive"),this.modal=document.createElement("div"),this.modal.setAttribute("class","modal theater-modal-inactive"),this.modalWrap.appendChild(this.modal),this.modalRight=document.createElement("div"),this.modalRight.setAttribute("id","modal-right"),this.modal.appendChild(this.modalRight),this.modalLeft=document.createElement("div"),this.modalLeft.setAttribute("id","modal-left"),this.modal.appendChild(this.modalLeft),this.modalClose=document.createElement("div"),this.modalClose.setAttribute("id","modal-close"),this.modal.appendChild(this.modalClose),this.modalContent=document.createElement("div"),this.modalContent.setAttribute("class","modal-content"),this.modal.appendChild(this.modalContent),this.modalText=document.createElement("div"),this.modalText.setAttribute("class","modal-description"),this.modal.appendChild(this.modalText),this.image=document.createElement("img"),this.iframe=document.createElement("iframe"),this.timelineWrap=document.createElement("div"),this.timelineWrap.setAttribute("class","timeline-wrap"),this.modal.appendChild(this.timelineWrap),this.bigDot=document.createElement("div"),this.bigDot.setAttribute("class","dot-big"),this.smallDot=document.createElement("div"),this.smallDot.setAttribute("class","dot-small");var t=document.querySelector("body");t.insertBefore(this.modalWrap,t.firstChild)},TheaterLightbox.prototype.setup=function(){for(var t=this,e=0;e<this.posters.length;e++){var i=this.posters[e].dataset.theaterGroup,r=!1;if(0===this.groupNames.length)this.groups[i]=[],r=!0;else for(var o=0;o<this.groupNames.length;o++){if(i===this.groupNames[o]){r=!1;break}r=!0}r&&(this.groups[i]=[],this.groupNames.push(i)),this.groups[i].push(this.posters[e]),this.posters[e].addEventListener("click",function(){t.currentPosterGroup=this.dataset.theaterGroup,t.currentPosterNum=t.groups[t.currentPosterGroup].indexOf(this),t.updateModal(t.currentPosterGroup,t.currentPosterNum,"new"),t.modalWrap.setAttribute("class","modal-wrap theater-bg-active"),t.modal.setAttribute("class","modal theater-modal-active")})}this.modalClose.onclick=function(){t.modalWrap.setAttribute("class","modal-wrap theater-bg-inactive"),t.modal.setAttribute("class","modal theater-modal-inactive"),t.currentPosterGroup="",t.currentPosterNum=0,t.clearModal(),t.clearTimeline()},this.modalRight.onclick=function(){t.groups[t.currentPosterGroup].length>1&&(t.clearModal(),setTimeout(function(){t.updateModal(t.currentPosterGroup,t.currentPosterNum,"right")},500))},this.modalLeft.onclick=function(){t.groups[t.currentPosterGroup].length>1&&(t.clearModal(),setTimeout(function(){t.updateModal(t.currentPosterGroup,t.currentPosterNum,"left")},500))}},TheaterLightbox.prototype.updateModal=function(t,e,i){var r=this;"new"==i?(this.currentPosterGroup=t,this.buildTimeline(t)):"timeline"==i?this.updateTimeline(e):"right"==i?(e==this.groups[t].length-1?e=0:e++,this.updateTimeline(e)):"left"==i?(0==e?e=this.groups[t].length-1:e--,this.updateTimeline(e)):console.log("error!!"),this.currentPosterGroup=t,this.currentPosterNum=e;var o,s,a=this.groups[this.currentPosterGroup][this.currentPosterNum].querySelector("img").alt,h=this.groups[this.currentPosterGroup][this.currentPosterNum].querySelector("img").title;"img"===this.groups[this.currentPosterGroup][this.currentPosterNum].dataset.type?(o=this.image.cloneNode(!0),s="img"):"vid"===this.groups[this.currentPosterGroup][this.currentPosterNum].dataset.type?(o=this.iframe.cloneNode(!0),s="vid"):console.log("wrong media type!"),o.setAttribute("src",a),this.modalContent.appendChild(o),setTimeout(function(){"img"==s?(r.mediaWidth=o.width,r.mediaHeight=o.height):"vid"==s?(r.mediaWidth=r.ytWidth,r.mediaHeight=r.ytHeight):console.log("another wrong media type!"),r.setModalDimesions(o)},10),this.modalText.textContent=h,this.modal.setAttribute("class","modal theater-modal-active")},TheaterLightbox.prototype.setModalDimesions=function(t){var e=this.mediaWidth/this.mediaHeight,i=.9*winHeight-80,r=i*e;r+48>=winWidth&&(r=.9*winWidth,i=r*(1/e)),t.style.height=i+"px",t.style.width=r+"px",this.modalContent.style.height=i+"px",this.modalContent.style.width=r+"px"},TheaterLightbox.prototype.clearModal=function(){var t=this;this.modal.setAttribute("class","modal theater-modal-inactive");var e=this.modalContent.querySelector("img")||this.modalContent.querySelector("iframe");e&&setTimeout(function(){t.modalContent.removeChild(e)},500)},TheaterLightbox.prototype.buildTimeline=function(t){for(var e=this,i=this.groups[t].length,r=0;i>r;r++){var o=this.bigDot.cloneNode(!0);if(this.timelineMarkers.push(o),this.timelineWrap.appendChild(o),r!=i-1){var s=this.smallDot.cloneNode(!0),a=this.smallDot.cloneNode(!0);this.timelineWrap.appendChild(s),this.timelineWrap.appendChild(a)}}var h=20*i+20*(i-1)*2;this.timelineWrap.style.width=h+"px",this.timelineMarkers[this.currentPosterNum].id="highlight";for(var n=0;n<this.timelineMarkers.length;n++)this.timelineMarkers[n].addEventListener("click",function(){var t=e.timelineMarkers.indexOf(this);e.currentPosterNum!=t&&(e.timelineMarkers[e.currentPosterNum].id="",e.currentPosterNum=t,e.clearModal(),setTimeout(function(){e.updateModal(e.currentPosterGroup,e.currentPosterNum,"timeline")},500),e.timelineMarkers[e.currentPosterNum].id="highlight")})},TheaterLightbox.prototype.updateTimeline=function(t){for(var e=0;e<this.timelineMarkers.length;e++)this.timelineMarkers[e].id="";this.timelineMarkers[t].id="highlight"},TheaterLightbox.prototype.clearTimeline=function(){for(;this.timelineWrap.firstChild;)this.timelineWrap.removeChild(this.timelineWrap.firstChild);this.timelineMarkers=[]},TheaterLightbox.prototype.getDimensions=function(){winWidth=document.documentElement.clientWidth,winHeight=document.documentElement.clientHeight;var t=this.modalContent.querySelector("img")||this.modalContent.querySelector("iframe");t&&this.setModalDimesions(t)},window.onload=function(){newTheater=new TheaterLightbox,newTheater.buildModal(),newTheater.setup(),newTheater.getDimensions()},window.onresize=function(){newTheater.getDimensions()};